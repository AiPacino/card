"use strict";var CanvasEditor=function(){};CanvasEditor.prototype={constructor:CanvasEditor,test:function(){alert(2)},addText:function(){var e=this,t=document.querySelector(".add-text");t&&t.addEventListener("click",function(t){t.stopPropagation();var s=document.createElement("div");s.innerText="请输入内容",s.classList.add("edit-elem"),s.classList.add("edit-text"),s.classList.add("default-text"),s.setAttribute("contenteditable","true"),editSide.appendChild(s),selectedElem=s,e.showEditTransformer(editTransformer,selectedElem),e.showEditPanel(selectedElem,editCanvas,textToolbar,imageToolbar)})},transparentEdit:function(){var e,t,s,l,n=document.querySelector(".range-circle");document.addEventListener("mousedown",function(a){a.target==n&&(e=!0,t=a.clientX,s=n.offsetLeft),l=selectedElem.classList.contains("edit-text")?document.querySelectorAll(".transparent-input")[1]:document.querySelectorAll(".transparent-input")[0]}),document.addEventListener("mousemove",function(a){if(e){var r=a.clientX-t;n.style.left=s+r+"px",n.offsetLeft<0&&(n.style.left="0px"),n.offsetLeft>130&&(n.style.left="130px"),l.value=parseInt(n.offsetLeft/130*100).toString()+"%",selectedElem.style.opacity=(n.offsetLeft/130).toString()}}),document.addEventListener("mouseup",function(t){e=!1})},showEditControler:function(e,t){var s=document.querySelectorAll(".edit-controler"),l=t.getBoundingClientRect(),n=document.querySelector(".edit-canvas"),a=n.getBoundingClientRect();s.forEach(function(e){e.style.display="none"}),e.style.left=l.left-a.left+"px",e.style.top=l.top-a.top+40+"px",e.style.zIndex="999",e.style.display="flex"},replaceImg:function(e){var t,s=new FileReader;e.addEventListener("change",function(l){(t=e.files[0])&&s.readAsDataURL(t)}),s.onload=function(e){var t=document.createElement("img");t.src=e.target.result,selectedElem.style.background="url("+e.target.result+")",selectedElem.style.backgroundSize="100% 100%";var s=selectedElem.getBoundingClientRect().width,l=t.height/t.width;selectedElem.style.height=editTransformer.style.height=s*l+"px"}},addImg:function(e){var t,s=this,l=new FileReader;e&&e.addEventListener("change",function(s){t=e.files[0],l.readAsDataURL(t)}),l.onload=function(e){var t=document.createElement("div"),l=document.createElement("img");l.src=e.target.result,t.classList.add("edit-elem"),t.classList.add("edit-image"),t.classList.add("default-image"),t.style.background="url("+e.target.result+")",t.style.backgroundSize="100% 100%",t.style.width=l.width+"px",t.style.height=l.height+"px",selectedElem=t,editSide.appendChild(t),s.showEditTransformer(),s.showEditPanel()}},showEditPanel:function(){var e=selectedElem.getBoundingClientRect(),t=editCanvas.getBoundingClientRect();selectedElem.classList.contains("edit-text")?(textToolbar.style.top=e.top-t.top-50+"px",textToolbar.style.left=selectedElem.offsetLeft+"px",textToolbar.style.display="flex"):selectedElem.classList.contains("edit-image")||selectedElem.classList.contains("default-image")?(imageToolbar.style.left=selectedElem.offsetLeft+"px",imageToolbar.style.top=e.top-t.top-50+"px",imageToolbar.style.display="flex"):selectedElem.classList.contains("edit-svg")&&(svgToolbar.style.left=e.left-t.left+"px",svgToolbar.style.top=e.top-t.top-50+"px",svgToolbar.style.display="flex")},showEditTransformer:function(){var e=selectedElem.getBoundingClientRect();"path"==selectedElem.tagName?(editTransformer.style.width=e.width+"px",editTransformer.style.height=e.height+"px",editTransformer.style.left=e.left-editCanvasRect.left+"px",editTransformer.style.top=e.top-editCanvasRect.top+"px",editTransformer.style.display="block"):(editTransformer.style.width=selectedElem.offsetWidth+"px",editTransformer.style.height=selectedElem.offsetHeight+"px",editTransformer.style.left=selectedElem.offsetLeft+"px",editTransformer.style.top=selectedElem.offsetTop+"px",editTransformer.style.transform=selectedElem.style.transform,editTransformer.style.display="block")},clearStyle:function(){for(var e in arguments)arguments[e].style=""},rotate:function(e,t,s){var l,n,a,r,o;o=e.getBoundingClientRect(),s.addEventListener("mousedown",function(e){r=!0}),document.addEventListener("mouseup",function(e){r=!1}),document.addEventListener("mousemove",function(s){r&&(l=s.clientX-o.left-o.width/2,n=s.clientY-o.top-o.height/2,a=Math.abs(180*Math.atan(n/l)/Math.PI),l<0&&n>=0&&(a=90-a),l<=0&&n<=0&&(a+=90),l>=0&&n<=0&&(a=270-a),l>=0&&n>=0&&(a=270+a),e.style.transform=t.style.transform="rotate("+a+"deg)")})},editTransparent:function(e){this.selectedElem.style.opacity=e+"%"},editDlete:function(){this.selectedElem.parent.removechild(this.selectedElem)},editColor:function(e){this.selectedElem.style.color=e},hexToRgb:function(e){var t=[],s=[];e=e.replace(/#/,"");for(var l=0;l<3;l++)t[l]="0x"+e.substr(l+2,2),s.push(parseInt(Number(t[l])));return"rgb("+s.join(",")+")"},getSvgTransform:function(e,t,s){var l,n=e.getAttribute("transform");switch(n||(e.setAttribute("transform","translate(0,0) scale(1,1)"),n=e.getAttribute("transform")),t){case"translate":var a=/translate\((.*?)\)/;return l=n.match(a),l?s?l[1].split(","):l[0]:s?[0,0]:"translate(0,0)";case"scale":var a=/scale\((.*?)\)/;return l=n.match(a),l?s?l[1].split(","):l[0]:s?[1,1]:"scale(1,1)"}}};