"use strict";function getCards(e,t){return new Promise(function(n,a){var r=document.createDocumentFragment(),c=document.createElement("div"),o=document.createElement("i"),i=document.createElement("p");c.className="loader",o.className="fa fa-spinner fa-pulse fa-3x fa-fw margin-bottom",i.innerText="加载中...",c.appendChild(o),c.appendChild(i),r.appendChild(c);var s=new XMLHttpRequest;url="/getcards?type="+e,s.onreadystatechange=function(){3===s.readyState&&(t.innerHTML="",t.appendChild(r)),4===s.readyState&&200===s.status&&n(JSON.parse(s.responseText))},s.open("GET",url,!0),s.send()})}var cateMenu=document.querySelector(".category-menu");if(cateMenu){var cateMenuLi=cateMenu.querySelectorAll("li");cateMenuLi.forEach(function(e){e.addEventListener("click",function(t){cateMenuLi.forEach(function(e){e.className=""}),e.className="active";var n=t.target.type;console.log(n);var a=document.querySelector(".temp-list");getCards(n,a).then(function(e){var t=document.querySelector("#card_template"),n=Handlebars.compile(t.innerHTML);a.innerHTML=n(e),console.log(e)})})})}var cateMenu=document.querySelector(".thame-list");if(cateMenu){var cateMenuLi=cateMenu.querySelectorAll("li");cateMenuLi.forEach(function(e){e.addEventListener("click",function(e){var t=e.target.type,n=document.querySelector(".template");getCards(t,n).then(function(e){var t=document.querySelector("#edit_card_template"),a=Handlebars.compile(t.innerHTML);n.innerHTML=a(e)})})})}var templateUl=document.querySelector(".template");templateUl&&templateUl.addEventListener("click",function(e){var t=e.target.parentNode;if("LI"==t.tagName){var n=t.dataset.id,a=new XMLHttpRequest,r="/getEditCard?id="+n;a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var e=JSON.parse(a.responseText),t=document.querySelector(".side-front"),n=document.querySelector(".side-back");t.innerHTML=e.sideFront,n.innerHTML=e.sideBack}},a.open("GET",r,!0),a.send()}}),function(){var e=document.querySelector(".temp-list");e&&e.addEventListener("click",function(e){var t,n=e.target,a=n.parentNode.querySelector("a");if(a&&(t=a.href.match(/edituser\/(\S*)/)[1]),n.classList.contains("collection"))if(n.classList.contains("collection-active")){var r=new XMLHttpRequest;r.onreadystatechange=function(){if((r.readyState=200==r.status)&&"1"==r.responseText){n.classList.remove("collection-active");new Notyf({delay:2e3}).confirm("取消收藏")}},r.open("POST","/deletecollection",!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send("cardId="+t)}else{var r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState=200==r.status)if("1"==r.responseText){n.classList.add("collection-active");var e=new Notyf({delay:2e3});e.confirm("收藏成功")}else if("-1"==r.responseText){console.log(r.responseText);var e=new Notyf({delay:2e3});e.alert("请先登录")}},r.open("POST","/addcollection",!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send("cardId="+t)}})}();